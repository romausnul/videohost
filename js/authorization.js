var Authorization=new function(){var o={AuthorizationFormUrl:void 0,RegistrationFormUrl:void 0,ForgotPasswordFormUrl:void 0};this.init=function(e){o=$.extend(o,e)},this.ShowAuthorizationPopup=function(){clearMsg(),$("#authorization-popup").length>0?showPopup($("#authorization-popup")):$.ajax({url:o.AuthorizationFormUrl,success:function(o){$("#popup-container").append(o),showPopup($("#authorization-popup"))},error:showErrorMessage})},this.ShowRegistrationPopup=function(){clearMsg(),$("#registration-popup").length>0?showPopup($("#registration-popup")):$.ajax({url:o.RegistrationFormUrl,success:function(o){$("#popup-container").append(o),showPopup($("#registration-popup"))},error:showErrorMessage})},this.ShowForgotPasswordPopup=function(){$("#forget-password-popup").length>0?showPopup($("#forget-password-popup")):$.ajax({url:o.ForgotPasswordFormUrl,success:function(o){$("#popup-container").append(o),showPopup($("#forget-password-popup"))},error:showErrorMessage})}};function showPopup(o){var e=window.innerHeight?window.innerHeight:document.documentElement.clientHeight;o.css({top:o.outerHeight(!0)<e?.5*(e-o.outerHeight(!0)):$(window).scrollTop(),position:o.outerHeight(!0)<e?"fixed":"absolute"}),$("div.popup").not(o).fadeOut(300),$("#overlay-shadow").fadeIn(300),o.fadeIn(200),o.children("div.close").remove(),$("<div/>",{class:"close",click:function(){$("#upload-popup:visible").length&&$("#upload-overlay").fadeIn(300),hidePopup()}}).appendTo(o),o.children("div.loader").remove(),$("<div/>",{class:"loader",id:o.attr("id")+"-loader"}).appendTo(o),o.find("input[type='reset']").off("click"),o.find("input[type='reset']").on("click",hidePopup)}function hidePopup(){$("div.popup").not("#upload-popup").fadeOut(300),$("#overlay-shadow").fadeOut(300),$("#success-register-popup").remove(),$("#video-popup").remove(),$("#video-no-exist-popup").hide(),$("div.popup iframe").css("visibility","hidden")}function redrawPopups(){$("div.popup").each((function(){var o=$(this),e=window.innerHeight?window.innerHeight:document.documentElement.clientHeight;"block"==o.css("display")&&o.css({top:o.outerHeight(!0)<e?.5*(e-o.outerHeight(!0)):$(window).scrollTop(),position:o.outerHeight(!0)<e?"fixed":"absolute"})}))}function Authorize(o){var e=document.location.href;switch(parseInt(o.return_code)){case 0:if(-1!=e.indexOf("#authorize?ReturnUrl=")){location.replace(e.slice(e.indexOf("#authorize?ReturnUrl=")+"#authorize?ReturnUrl=".length));break}location.replace("/videos");break;case 13:$("#authorization-form").find("div.error-tooltip").text(o.description).fadeIn(300)}}function Register(o){switch(parseInt(o.return_code)){case 1:yaCounter18545545.reachGoal("first_in");var e=$("<div/>",{id:"success-register-popup",class:"popup"}).appendTo($("#popup-container"));showPopup($("#success-register-popup")),$("<div/>",{class:"success-icon"}).appendTo(e),$("<h2/>",{text:o.title}).appendTo(e),$("<p/>",{text:o.description}).appendTo(e);break;case 2:$("#registration-form").find("span.error-tooltip").text(o.description).fadeIn(300)}}function openPopupWindow(o,e,t){var i=(screen.width-e)/2,r=(screen.height-t)/2;window.open(o,"","width="+e+", height="+t+", top="+r+",left="+i+"location = 0, status = 1, resizable = 0, scrollbars = 1, toolbar = 0")}function handleAuthResult(o,e,t){if(o.length>0)showErrorMessage();else{var i=document.location.href;-1!=i.indexOf("#authorize?ReturnUrl=")&&(t=i.slice(i.indexOf("#authorize?ReturnUrl=")+"#authorize?ReturnUrl=".length)),$.ajax({url:e,data:"return_url="+t,type:"POST",success:function(o,e,t){if("text/html; charset=utf-8"==t.getResponseHeader("content-type")){var i=$("#bind-authorization-popup");i.html(o),i.find("input[type='reset']").on("click",hidePopup),$("#bind-registration-form, #bind-authorization-form").submit((function(){validateEmail($(this).find("#email"))})),showPopup(i)}},error:function(){showErrorMessage()}})}}function BindAuthorize(o){var e=location.href;switch(parseInt(o.return_code)){case 0:if(-1!=e.indexOf("#authorize?ReturnUrl=")){location.replace(e.slice(e.indexOf("#authorize?ReturnUrl=")+"#authorize?ReturnUrl=".length));break}location.replace("/videos");break;case 13:$("#bind-authorization-form").find("div.error-tooltip").text(o.description).fadeIn(300)}}function BindRegister(o){var e=location.href;switch(parseInt(o.return_code)){case 0:if(yaCounter18545545.reachGoal("first_in"),-1!=e.indexOf("#authorize?ReturnUrl=")){location.replace(e.slice(e.indexOf("#authorize?ReturnUrl=")+"#authorize?ReturnUrl=".length));break}location.replace("/videos");break;case 1:yaCounter18545545.reachGoal("first_in");var t=$("<div/>",{id:"success-register-popup",class:"popup"}).appendTo($("#js-popups"));showPopup($("#success-register-popup")),$("<h2/>",{text:o.title}).appendTo(t),$("<span/>",{text:o.description}).appendTo(t);break;case 2:$("#bind-registration-form").find("span.error-tooltip").text(o.description).fadeIn(300)}}function ChangePassword(o){switch(parseInt(o.return_code)){case 0:$("#add-additional-info").length>0&&$("#add-additional-info").submit();var e=$("<div/>",{id:"change-password-success-popup",class:"popup"}).appendTo($("#js-popups"));showPopup(e),$("<h2/>",{text:o.title}).appendTo(e),$("<span/>",{text:o.description}).appendTo(e);break;case 1:$("#confirm-email-popup div.error-tooltip").text(o.description).slideDown(200)}}function ForgetPassword(o){switch(parseInt(o.return_code)){case 0:var e=$("<div/>",{id:"forget-password-success-popup",class:"popup"}).appendTo($("#popup-container"));showPopup(e),$("<div/>",{class:"success-icon"}).appendTo(e),$("<h2/>",{text:o.title}).appendTo(e),$("<span/>",{text:o.description}).appendTo(e);break;default:$("#forget-password-form").find("div.error-tooltip").text(o.description).slideDown(300)}}function clearMsg(){$(".error-tooltip").css("display","none").text("")}function showErrorMessage(){$("#general-error").fadeIn(300)}function validateEmail(o){var e=o.val();e=e.replace(/\s+/g,""),o.val(e)}function shortenName(o,e){return null==e&&(e=35),o.length>e?o.slice(0,e-10)+"..."+o.slice(-7):o}$(document).ready((function(){$(document).keyup((function(o){27==(o.which?o.which:o.keyCode)&&($(o.target).is("embed")||hidePopup())})),$("#overlay-shadow").on("click",hidePopup),$("#general-error").on("click",(function(){$(this).fadeOut(150)})),$(document).on("click",".error-tooltip",(function(){$(this).fadeOut(150)})),$(document).on("submit","#authorization-form, #registration-form, #forget-password-form",(function(){$(this).find("#email").length?validateEmail($(this).find("#email")):validateEmail($(this).find("#password_email"))})),$(document).on("click","#js-forgot-password-btn",(function(){Authorization.ShowForgotPasswordPopup()})),$(document).on("click","#js-register-user-btn",(function(){Authorization.ShowRegistrationPopup()})),$(document).on("click",".js-log-in",(function(){Authorization.ShowAuthorizationPopup()})),$(document).on("submit","#authorization-form",(function(o){o.preventDefault();var e=$(this),t=e.attr("action"),i=e.find("[name=email]").val(),r=e.find("[name=password]").val(),n=e.find("#remember").is(":checked");$.ajax({url:t,type:"POST",data:{email:i,password:r,remember:n},beforeSend:clearMsg,success:Authorize,error:showErrorMessage})})),$(document).on("submit","#registration-form",(function(o){o.preventDefault();var e=$(this),t=e.attr("action"),i=e.find("[name=email]").val(),r=e.find("#confirm_terms").is(":checked");$.ajax({url:t,type:"POST",data:{email:i,confirm_terms:r},beforeSend:clearMsg,success:Register,error:showErrorMessage})})),$(document).on("submit","#forget-password-form",(function(o){o.preventDefault();var e=$(this),t=e.attr("action"),i=e.find("[name=email]").val();$.ajax({url:t,type:"POST",data:{email:i},beforeSend:clearMsg,success:ForgetPassword,error:showErrorMessage})})),$(document).on("change","input[name=confirm_terms]",(function(o){var e=$(o.currentTarget);e.parents("form").find("*[type=submit]").attr("disabled",!e.is(":checked"))})),-1!=document.location.href.indexOf("#authorize")&&Authorization.ShowAuthorizationPopup(),-1!=document.location.href.indexOf("#register")&&Authorization.ShowRegistrationPopup(),$("#confirm-email-popup").length>0&&showPopup($("#confirm-email-popup")),$("#wrong-restore-link-popup").length>0&&showPopup($("#wrong-restore-link-popup")),$(window).resize(redrawPopups)}));